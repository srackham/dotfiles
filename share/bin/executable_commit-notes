#!/usr/bin/env bash

MAN_PAGE_SPEC="NAME
    commit-notes - Commit notes \$HOME/notes directory

SYNOPSIS
    commit-notes -h | --help

DESCRIPTION
    Commit any changes in the \$HOME/notes Git repository since the last commit with a dated
    commit message like the following example:

        Updates to 01-Jun-2025

    Log the action to stdout (if there are no changes since the last commit log \"No changes since the
    last commit\" to stdout and exit.
"

# Show help if requested
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    echo "$MAN_PAGE_SPEC"
    exit 0
fi

NOTES_DIR="$HOME/notes"
cd "$NOTES_DIR" || { echo "Directory $NOTES_DIR not found."; exit 1; }

# Check for changes since last commit
if git diff --quiet && git diff --cached --quiet; then
    echo "No changes since the last commit"
    exit 0
fi

# Stage all changes
git add -A

# Commit with dated message
DATE_STR=$(date +"%d-%b-%Y")
git commit -m "Updates to $DATE_STR"

echo "Committed changes with message: Updates to $DATE_STR"

